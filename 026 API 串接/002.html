<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ajax - 以 GET 方法串接 API 資料 ( 以 JSON 為例 )</title>
   
    <style>

    </style>
  </head>
  <body>
    <!--XMLHttpRequest-->
    <script>
        // 1.設一個變數把API的URL存起來
        var dataUrl= "https://cloud.culture.tw/frontsite/trans/SearchShowAction.do?method=doFindTypeJ&category=6"
        // 2.new一個XMLHttpRequest物件(以此物件的方法進行資料請求) 
        var xhr = new XMLHttpRequest()
        // 3.以GET方法開啟一個請求
        //open('Method',API的URL,預設值為true非同步進行)
        xhr.open('GET',dataUrl, true)
        // 4.送出請求(若為GET參數不填或填null)
        xhr.send() 
        // 5-1 或直接用 onload => 資料接收/送出成功後執行的function
        /*
        xhr.onload = function () {
            var data = JSON.parse(this.responseText);
            console.log(data);
        }*/

      

        // 5-2.寫一個function處理狀態改變時(onReadyStateChange)
        //   0=執行前    1=讀取中   2=已讀取  3=資訊交換中  4=完成
        //   status(HTTP狀態碼):200 正常完成
        xhr.onreadystatechange = function(){
            // 如果完成(readyState=4 , 且HTTP狀態正常 status=200)
            if(this.readyState === 4 && this.status === 200){
                // 將接回的資料存到變數data
                var data = JSON.parse(this.responseText);
                // 6.~~ 應用data(這裡先以console.log確認打回來的資料內容):  
                    console.log(data);
            }
        }

    </script>
    <!-- Note 
    .open('～',～, true/false)

    true 非同步(預設值)：程式碼不會等資料回傳回來就會繼續執行後續程式碼
    false 同步：等資料處理（回傳/接收）完畢才繼續往下執行後續程式碼
    預設使用非同步的原因:若資料量大時等全部載完才執行後續動作UX很糟(卡在那)


    JSON.parse
    JSON格式資料型態是陣列內包物件
    資料傳輸時會被轉換成string(字串)
    使用JSON.parse將資料轉換回原本的格式（陣列包物件）
    
    -->

    <!-- 
    <script>
         var dataUrl= "https://cloud.culture.tw/frontsite/trans/SearchShowAction.do?method=doFindTypeJ&category=6"
         var xhr = new XMLHttpRequest()  
         xhr.open("Get",dataUrl,true)
         xhr.send()
         xhr.onreadystatechange = function (){
            if (this.readyState === 4) {
              if (this.status >=200 && this.status <300 ) {
                   // 將接回的資料存到變數data
                   var data = JSON.parse(this.responseText)
                   console.log(data)
              }
            
            }
         }
    </script>-->

    
   
  </body>
</html>